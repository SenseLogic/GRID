// -- IMPORTS

#include "base.h"

// -- CONSTANTS

const INT_8
    AngleSinusArray[ AngleCount ] =
        {
            0, 2, 3, 5, 6, 8, 9, 11, 12, 14, 16, 17, 19, 20, 22, 23,
            24, 26, 27, 29, 30, 32, 33, 34, 36, 37, 38, 39, 41, 42, 43, 44,
            45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 56, 57, 58, 59,
            59, 60, 60, 61, 61, 62, 62, 62, 63, 63, 63, 64, 64, 64, 64, 64,
            64, 64, 64, 64, 64, 64, 63, 63, 63, 62, 62, 62, 61, 61, 60, 60,
            59, 59, 58, 57, 56, 56, 55, 54, 53, 52, 51, 50, 49, 48, 47, 46,
            45, 44, 43, 42, 41, 39, 38, 37, 36, 34, 33, 32, 30, 29, 27, 26,
            24, 23, 22, 20, 19, 17, 16, 14, 12, 11, 9, 8, 6, 5, 3, 2,
            0, -2, -3, -5, -6, -8, -9, -11, -12, -14, -16, -17, -19, -20, -22, -23,
            -24, -26, -27, -29, -30, -32, -33, -34, -36, -37, -38, -39, -41, -42, -43, -44,
            -45, -46, -47, -48, -49, -50, -51, -52, -53, -54, -55, -56, -56, -57, -58, -59,
            -59, -60, -60, -61, -61, -62, -62, -62, -63, -63, -63, -64, -64, -64, -64, -64,
            -64, -64, -64, -64, -64, -64, -63, -63, -63, -62, -62, -62, -61, -61, -60, -60,
            -59, -59, -58, -57, -56, -56, -55, -54, -53, -52, -51, -50, -49, -48, -47, -46,
            -45, -44, -43, -42, -41, -39, -38, -37, -36, -34, -33, -32, -30, -29, -27, -26,
            -24, -23, -22, -20, -19, -17, -16, -14, -12, -11, -9, -8, -6, -5, -3, -2
        };
const INT_8
    YAngleArray[ 1089 ] =
    {
        0, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
        0, 32, 45, 51, 54, 56, 57, 58, 59, 59, 60, 60, 61, 61, 61, 61, 61, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 63, 63, 63, 63, 63,
        0, 19, 32, 40, 45, 48, 51, 53, 54, 55, 56, 57, 57, 58, 58, 59, 59, 59, 59, 60, 60, 60, 60, 60, 61, 61, 61, 61, 61, 61, 61, 61, 61,
        0, 13, 24, 32, 38, 42, 45, 48, 49, 51, 52, 53, 54, 55, 55, 56, 56, 57, 57, 58, 58, 58, 58, 59, 59, 59, 59, 59, 60, 60, 60, 60, 60,
        0, 10, 19, 26, 32, 37, 40, 43, 45, 47, 48, 50, 51, 52, 53, 53, 54, 55, 55, 56, 56, 56, 57, 57, 57, 58, 58, 58, 58, 58, 59, 59, 59,
        0, 8, 16, 22, 27, 32, 36, 39, 41, 43, 45, 47, 48, 49, 50, 51, 52, 52, 53, 54, 54, 54, 55, 55, 56, 56, 56, 57, 57, 57, 57, 57, 58,
        0, 7, 13, 19, 24, 28, 32, 35, 38, 40, 42, 44, 45, 46, 48, 48, 49, 50, 51, 52, 52, 53, 53, 54, 54, 54, 55, 55, 55, 56, 56, 56, 56,
        0, 6, 11, 16, 21, 25, 29, 32, 35, 37, 39, 41, 42, 44, 45, 46, 47, 48, 49, 50, 50, 51, 51, 52, 52, 53, 53, 54, 54, 54, 55, 55, 55,
        0, 5, 10, 15, 19, 23, 26, 29, 32, 34, 37, 38, 40, 42, 43, 44, 45, 46, 47, 48, 48, 49, 50, 50, 51, 51, 52, 52, 53, 53, 53, 54, 54,
        0, 5, 9, 13, 17, 21, 24, 27, 30, 32, 34, 36, 38, 39, 41, 42, 43, 44, 45, 46, 47, 48, 48, 49, 49, 50, 50, 51, 51, 52, 52, 52, 53,
        0, 4, 8, 12, 16, 19, 22, 25, 27, 30, 32, 34, 36, 37, 39, 40, 41, 42, 43, 44, 45, 46, 47, 47, 48, 48, 49, 50, 50, 50, 51, 51, 52,
        0, 4, 7, 11, 14, 17, 20, 23, 26, 28, 30, 32, 34, 35, 37, 38, 39, 41, 42, 43, 44, 44, 45, 46, 46, 47, 48, 48, 49, 49, 50, 50, 51,
        0, 3, 7, 10, 13, 16, 19, 22, 24, 26, 28, 30, 32, 34, 35, 37, 38, 39, 40, 41, 42, 43, 44, 44, 45, 46, 46, 47, 48, 48, 48, 49, 49,
        0, 3, 6, 9, 12, 15, 18, 20, 22, 25, 27, 29, 30, 32, 34, 35, 36, 37, 39, 40, 41, 41, 42, 43, 44, 44, 45, 46, 46, 47, 47, 48, 48,
        0, 3, 6, 9, 11, 14, 16, 19, 21, 23, 25, 27, 29, 30, 32, 33, 35, 36, 37, 38, 39, 40, 41, 42, 42, 43, 44, 45, 45, 46, 46, 47, 47,
        0, 3, 5, 8, 11, 13, 16, 18, 20, 22, 24, 26, 27, 29, 31, 32, 33, 35, 36, 37, 38, 39, 40, 40, 41, 42, 43, 43, 44, 45, 45, 46, 46,
        0, 3, 5, 8, 10, 12, 15, 17, 19, 21, 23, 25, 26, 28, 29, 31, 32, 33, 34, 35, 37, 37, 38, 39, 40, 41, 42, 42, 43, 43, 44, 45, 45,
        0, 2, 5, 7, 9, 12, 14, 16, 18, 20, 22, 23, 25, 27, 28, 29, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 40, 41, 42, 42, 43, 44, 44,
        0, 2, 5, 7, 9, 11, 13, 15, 17, 19, 21, 22, 24, 25, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 39, 40, 41, 41, 42, 43, 43,
        0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 21, 23, 24, 26, 27, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 38, 39, 40, 40, 41, 42, 42,
        0, 2, 4, 6, 8, 10, 12, 14, 16, 17, 19, 20, 22, 23, 25, 26, 27, 29, 30, 31, 32, 33, 34, 35, 36, 37, 37, 38, 39, 39, 40, 41, 41,
        0, 2, 4, 6, 8, 10, 11, 13, 15, 16, 18, 20, 21, 23, 24, 25, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 36, 37, 38, 38, 39, 40, 40,
        0, 2, 4, 6, 7, 9, 11, 13, 14, 16, 17, 19, 20, 22, 23, 24, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 35, 36, 37, 38, 38, 39, 39,
        0, 2, 4, 5, 7, 9, 10, 12, 14, 15, 17, 18, 20, 21, 22, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 34, 35, 36, 37, 37, 38, 39,
        0, 2, 3, 5, 7, 8, 10, 12, 13, 15, 16, 18, 19, 20, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 34, 35, 36, 37, 37, 38,
        0, 2, 3, 5, 6, 8, 10, 11, 13, 14, 16, 17, 18, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 34, 35, 36, 36, 37,
        0, 2, 3, 5, 6, 8, 9, 11, 12, 14, 15, 16, 18, 19, 20, 21, 22, 24, 25, 26, 27, 28, 29, 30, 30, 31, 32, 33, 34, 34, 35, 36, 36,
        0, 2, 3, 5, 6, 7, 9, 10, 12, 13, 14, 16, 17, 18, 19, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 30, 31, 32, 33, 33, 34, 35, 35,
        0, 1, 3, 4, 6, 7, 9, 10, 11, 13, 14, 15, 16, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 30, 31, 32, 33, 33, 34, 35,
        0, 1, 3, 4, 6, 7, 8, 10, 11, 12, 14, 15, 16, 17, 18, 19, 21, 22, 23, 24, 25, 26, 26, 27, 28, 29, 30, 31, 31, 32, 33, 33, 34,
        0, 1, 3, 4, 5, 7, 8, 9, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 27, 28, 29, 30, 31, 31, 32, 33, 33,
        0, 1, 3, 4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 28, 29, 30, 31, 31, 32, 33,
        0, 1, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 25, 26, 27, 28, 29, 29, 30, 31, 31, 32
    };

// -- VARIABLES

UINT_16
    RandomNatural = 32347,
    FrameIndex = 0;

// -- FUNCTIONS

inline UINT_16 GetRandomNatural16(
    )
{
    RandomNatural = RandomNatural * 45 + 21;

    return RandomNatural;
}

// ~~

UINT_16 GetRandomNatural(
    UINT_8 bit_count
    )
{
    return GetRandomNatural16() >> ( 16 - bit_count );
}

// ~~

#define GetRandomInteger16() \
    \
    \ ( ( INT_16 )GetRandomNatural16() )

// ~~

#define GetRandomInteger( _bit_count_ ) \
    \
    ( ( ( INT_16 )GetRandomNatural16() ) >> ( 16 - _bit_count_ ) )

// ~~

INT_14_2 GetOriginDistance(
    INT_14_2 x,
    INT_14_2 z
    )
{
    if ( x < 0 )
    {
        x = -x;
    }

    if ( z < 0 )
    {
        z = -z;
    }

    x >>= 2;
    z >>= 2;

    if ( x < z )
    {
        return ( x + z ) - ( x >> 2 );
    }
    else
    {
        return ( x + z ) - ( z >> 2 );
    }
}

// ~~

INT_8 GetYAngle(
    INT_14_2 x,
    INT_14_2 z
    )
{
    while ( x < -32
            || x > 32
            || z < -32
            || z > 32 )
    {
        x >>= 1;
        z >>= 1;
    }

    if ( z >= 0 )
    {
        if ( x >= 0 )
        {
            return YAngleArray[ z * 33 + x ];
        }
        else
        {
            return -YAngleArray[ z * 33 - x ];
        }
    }
    else
    {
        if ( x >= 0 )
        {
            return 128 - YAngleArray[ z * -33 + x ];
        }
        else
        {
            return YAngleArray[ z * -33 - x ] - 128;
        }
    }
}

// ~~

void RotatePosition(
    INT_14_2 *x,
    INT_14_2 *z,
    INT_8 rotation_y_angle
    )
{
    INT_14_2
        old_x,
        old_z;

    if ( rotation_y_angle == -5 )
    {
        old_x = *x;
        old_z = *z;
        *x = old_x - ( ( old_z + 4 ) >> 3 );
        *z = old_z + ( ( old_x + 4 ) >> 3 );
    }
    else if ( rotation_y_angle == 5 )
    {
        old_x = *x;
        old_z = *z;
        *x = old_x + ( ( old_z + 4 ) >> 3 );
        *z = old_z - ( ( old_x + 4 ) >> 3 );
    }
}
